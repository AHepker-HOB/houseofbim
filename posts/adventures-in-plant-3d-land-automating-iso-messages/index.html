<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Adventures in Plant 3D Land: Automating Iso Messages" /><meta name="author" content="Josh Howard" /><meta property="og:locale" content="en_US" /><meta name="description" content="If you are an avid keyboard user like me, then you probably share my contempt for the developers choice of mandating a dialog prompt for text entry on Plant 3D IsoMessages. I know it was a constant irritation of mine years ago when I was first using P3D. Especially since there were so many logical applications for standardized notes that could be made if they would just let me. Maybe I’m a pessimist for having so little faith in people (and myself) to be consistent, but I do think my personal experiences easily justify my dismal expectations of typical users." /><meta property="og:description" content="If you are an avid keyboard user like me, then you probably share my contempt for the developers choice of mandating a dialog prompt for text entry on Plant 3D IsoMessages. I know it was a constant irritation of mine years ago when I was first using P3D. Especially since there were so many logical applications for standardized notes that could be made if they would just let me. Maybe I’m a pessimist for having so little faith in people (and myself) to be consistent, but I do think my personal experiences easily justify my dismal expectations of typical users." /><link rel="canonical" href="/posts/adventures-in-plant-3d-land-automating-iso-messages/" /><meta property="og:url" content="/posts/adventures-in-plant-3d-land-automating-iso-messages/" /><meta property="og:site_name" content="House of BIM" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-05-04T01:40:00-07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Adventures in Plant 3D Land: Automating Iso Messages" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"headline":"Adventures in Plant 3D Land: Automating Iso Messages","dateModified":"2018-05-04T01:40:00-07:00","datePublished":"2018-05-04T01:40:00-07:00","description":"If you are an avid keyboard user like me, then you probably share my contempt for the developers choice of mandating a dialog prompt for text entry on Plant 3D IsoMessages. I know it was a constant irritation of mine years ago when I was first using P3D. Especially since there were so many logical applications for standardized notes that could be made if they would just let me. Maybe I’m a pessimist for having so little faith in people (and myself) to be consistent, but I do think my personal experiences easily justify my dismal expectations of typical users.","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/adventures-in-plant-3d-land-automating-iso-messages/"},"url":"/posts/adventures-in-plant-3d-land-automating-iso-messages/","@type":"BlogPosting","author":{"@type":"Person","name":"Josh Howard"},"@context":"https://schema.org"}</script><title>Adventures in Plant 3D Land: Automating Iso Messages | House of BIM</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end">
<div class="profile-wrapper text-center">
<div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/favicons/favicon-96x96.png" alt="avatar" onerror="this.style.display='none'"> </a>
</div>
<div class="site-title mt-3"> <a href="/">House of BIM</a>
</div>
<div class="site-subtitle font-italic">Stuff and Things...it's what we do</div>
</div>
<ul class="w-100">
<li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a>
</li>
<li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a>
</li>
<li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a>
</li>
<li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-database ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a>
</li>
<li class="nav-item"> <a href="/links/" class="nav-link"> <i class="fa-fw fa fa-link ml-xl-3 mr-xl-3 unloaded"></i> <span>LINKS</span> </a>
</li>
<li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fa fa-question ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a>
</li>
</ul>
<div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/AHepker-HOB" aria-label="github" class="order-3" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/andrew-hepker-738b0b80/" aria-label="linkedin" class="order-4" target="_blank" rel="noopener noreferrer"> <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href=%5B'mailto:',%20'andrew',%20'.',%20'hepker',%20'@house',%20'ofbim.com'%5D.join('')" aria-label="email" class="order-5"> <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6"> <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span>
</div>
</div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Adventures in Plant 3D Land: Automating Iso Messages</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div>
<i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel">Cancel</span>
</div></div><div id="main-wrapper">
<div id="main">
<div class="row">
<div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
<h1 data-toc-skip>Adventures in Plant 3D Land: Automating Iso Messages</h1>
<div class="post-meta text-muted d-flex flex-column">
<div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, May 4, 2018, 1:40 AM -0700"> May 4, 2018 <i class="unloaded">2018-05-04T01:40:00-07:00</i> </span> by <span class="author"> Josh Howard </span>
</div>
<div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1930 words">10 min</span>
</div>
</div>
<div class="post-content">
<p>If you are an avid keyboard user like me, then you probably share my contempt for the developers choice of mandating a dialog prompt for text entry on Plant 3D IsoMessages. I know it was a constant irritation of mine years ago when I was first using P3D. Especially since there were so many logical applications for standardized notes that could be made if they would just let me. Maybe I’m a pessimist for having so little faith in people (and myself) to be consistent, but I do think my personal experiences easily justify my dismal expectations of typical users.</p>
<p>Anyway, I recently had the misfortune of being subjected to that same anguish, but these days I am a much craftier automater. So, things have generally been going my way this time around and I will be talking about one of those many victories in this post.</p>
<p>During the course of this current project I’ve unfortunately had to dive VERY deep into the Plant SDK. Which is an absolute labyrinth and thankfully I am finally “caching on” to their philosophy. I still don’t like something this soupy and seemingly incoherent, but I will admit the crazy fast query of LineGroup data for the ENTIRE project is a pretty impressive byproduct of the choices they’ve made. Once I figured it out, it was a very small amount of code to export all the line group data to a csv, edit it in excel and put it back into the project database. I’ve done very similar tricks with CADmep, but it is a lot more messy and overhead intensive.</p>
<p>Having failed miserably with lisp years ago, one of my top agenda items this time around was automating the creation of standardize Iso Messages using the .Net API. I found almost no documentation in the SDK download and the only help the internet had to offer was some <a href="http://adndevblog.typepad.com/autocad/2012/09/create-isospheresymbol-in-plant3d-using-objectarx.html" target="_blank" rel="noopener noreferrer">ObjectARX pseudo code</a> that ultimately fell short of making a fully functional Iso Message Sphere. After a ton of ineffective web browsing and some deciphering of related code, I did gain fundamental insights on how these existed and related to other Plant objects. However, it was very disappointing to have my .Net attempt fail miserably like my lisp attempt did years before. I actually considered accomplishing my goal purely from post processing the PCF’s, but then I eventually picked up on the fact that numerous Iso Spheres derived from the same base class and set upon convincing a pig to act like a bull; which paid off!</p>
<p>The Iso Message, Floor Symbol, Insulation Symbol and Location Point all derived from the same .Net namespace of:</p>
<p><code class="language-plaintext highlighter-rouge">Autodesk.ProcessPower.PnP3dObjects.IsoSphereSymbol</code></p>
<p>I also discovered that IsoSphere’s were essentially being claimed by a LineGroup and other than that they literally weren’t associated to anything. So, after some prodding I found that they had an AutoCAD extension dictionary, that contained an X-Record, that contained data, that Plant 3D makes some pretty wild behavioral changes based upon. I am still not sure if the first SafeArray list in my code has rigid values, but  I’ve had zero issues with the static values I extracted from an existing Iso Message; the documentation says these are declarations of dxf data types and you can see that if you entget the xRecord. However, the important thing is that the X-Record name determined the actual Sphere type and that the 2nd SafeArray (Data argument) did allow me to set the Message value, the Box type and whether it was dimensioned! What does this all mean? Well, with some some old school command lisp puppeteering of the PLANTISOADDINFO command we can build our IsoMessages from any of the other derived Sphere types that do not involve dialogs. Once it exists, then we just have to superimpose the desired data we want onto it.</p>
<p>Note: The PLANTISOADDINFO does not let you provide a point from code, I assume Plant 3D is using a specialized version of point selection user input due to its need of making a relationship between the sphere and a LineGroup. Based on what I know about the P3D’s API, you should want it doing this heavy lifting of object associations anyway. It is very fickle and these are truly paper thin relationships that are likely impossible to rebuild from lisp after the fact if it doesn’t make the proper decision upon creation. Please correct me if you find a way to associate a sphere after creation using lisp or Plant 3D commands. With this trick and my .Net background, I could pretty much fabricate these things from scratch using a block reference, but it’s quite ugly.</p>
<div class="language-lisp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td>
<td class="rouge-code"><pre><span class="p">(</span><span class="nb">defun</span> <span class="nv">HOB:CreateIsoMessage</span> <span class="p">(</span><span class="nv">msg</span> <span class="nv">box</span> <span class="nv">dimed</span> <span class="nb">/</span> <span class="nv">lent</span> <span class="nv">nsa</span> <span class="nv">nsd</span> <span class="nv">dic</span> <span class="nv">rec</span> <span class="nv">obj</span><span class="p">)</span>
  <span class="p">(</span><span class="k">setq</span> <span class="nv">lent</span> <span class="p">(</span><span class="nv">entlast</span><span class="p">)</span>
        <span class="nv">msg</span> <span class="p">(</span><span class="nv">acet-str-replace</span> <span class="s">" "</span> <span class="s">"@"</span> <span class="nv">msg</span><span class="p">)</span>
        <span class="nv">msg</span> <span class="p">(</span><span class="nv">acet-str-replace</span> <span class="s">"\n"</span> <span class="s">"$"</span> <span class="nv">msg</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">command</span> <span class="s">"PLANTISOADDINFO"</span> <span class="s">"L"</span> <span class="nv">pause</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">/=</span> <span class="p">(</span><span class="nv">vl-princ-to-string</span> <span class="nv">lent</span><span class="p">)</span> <span class="p">(</span><span class="nv">vl-princ-to-string</span> <span class="p">(</span><span class="nv">entlast</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">progn</span>
      <span class="p">(</span><span class="k">setq</span> <span class="nv">ent</span> <span class="p">(</span><span class="nv">entlast</span><span class="p">)</span>
            <span class="nv">obj</span> <span class="p">(</span><span class="nv">vlax-ename-&amp;gt</span><span class="c1">;vla-object ent)</span>
            <span class="nv">dic</span> <span class="p">(</span><span class="nv">vla-GetExtensionDictionary</span> <span class="nv">obj</span><span class="p">)</span>
            <span class="nv">rec</span> <span class="p">(</span><span class="nv">vla-item</span> <span class="nv">dic</span> <span class="mi">0</span><span class="p">)</span>
            <span class="nv">nsa</span> <span class="p">(</span><span class="nv">vlax-make-safearray</span> <span class="nv">vlax-vbInteger</span> <span class="o">'</span><span class="p">(</span><span class="mi">0</span> <span class="o">.</span> <span class="mi">2</span><span class="p">))</span>
            <span class="nv">nsd</span> <span class="p">(</span><span class="nv">vlax-make-safearray</span> <span class="nv">vlax-vbVariant</span> <span class="o">'</span><span class="p">(</span><span class="mi">0</span> <span class="o">.</span> <span class="mi">2</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null</span> <span class="nv">dimed</span><span class="p">)</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">dimed</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">dimmed</span> <span class="mi">1</span><span class="p">))</span>
      <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">or</span> <span class="p">(</span><span class="nb">null</span> <span class="nv">box</span><span class="p">)</span> <span class="p">(</span><span class="nb">/=</span> <span class="p">(</span><span class="k">type</span> <span class="nv">box</span><span class="p">)</span> <span class="ss">'INT</span><span class="p">))</span> <span class="p">(</span><span class="k">setq</span> <span class="nv">box</span> <span class="mi">0</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">vlax-safearray-put-element</span> <span class="nv">nsa</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">vlax-safearray-put-element</span> <span class="nv">nsa</span> <span class="mi">1</span> <span class="mi">90</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">vlax-safearray-put-element</span> <span class="nv">nsa</span> <span class="mi">2</span> <span class="mi">90</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">vlax-safearray-put-element</span> <span class="nv">nsd</span> <span class="mi">0</span> <span class="p">(</span><span class="nv">vlax-make-variant</span> <span class="nv">msg</span> <span class="nv">vlax-vbString</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">vlax-safearray-put-element</span> <span class="nv">nsd</span> <span class="mi">1</span> <span class="p">(</span><span class="nv">vlax-make-variant</span> <span class="nv">dimed</span> <span class="nv">vlax-vbLong</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">vlax-safearray-put-element</span> <span class="nv">nsd</span> <span class="mi">2</span> <span class="p">(</span><span class="nv">vlax-make-variant</span> <span class="nv">box</span> <span class="nv">vlax-vbLong</span><span class="p">))</span>
      <span class="p">(</span><span class="nv">vla-SetXRecordData</span> <span class="nv">rec</span> <span class="nv">nsa</span> <span class="nv">nsd</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">vla-put-name</span> <span class="nv">rec</span> <span class="s">"PnP3dMsg"</span><span class="p">)</span>
      <span class="p">)</span>
    <span class="p">)</span>
  <span class="p">)</span>

<span class="c1">;Example function call</span>
<span class="p">(</span><span class="nv">HOB:CreateIsoMessage</span> <span class="s">"Stuff and Things\nCan't forget THINGS!"</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)</span>
</pre></td>
</tr></tbody></table></code></div></div>
<p>Probably more verbose than needed, but there just isn’t much information out there about these and I thought my process background would be a fine example of how I consistently manage to solve my real world problems. In the world of code, there really is no spoon. Enjoy the new utility…</p>
<h1 id="update">Update</h1>
<p><em>This code was graciously posted by Jason Hudson in a comment on the former Wordpress site. We’ve included it here as an example of creating iso messages with the .NET API.</em></p>
<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
</pre></td>
<td class="rouge-code"><pre><span class="k">private</span> <span class="n">ObjectId</span> <span class="nf">CreateTieInPoint</span><span class="p">(</span><span class="kt">string</span> <span class="n">tipGroup</span><span class="p">,</span> <span class="kt">string</span> <span class="n">tipNumber</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Document</span> <span class="n">doc</span> <span class="p">=</span> <span class="n">AcadApp</span><span class="p">.</span><span class="n">DocumentManager</span><span class="p">.</span><span class="n">MdiActiveDocument</span><span class="p">;</span>
    <span class="n">Database</span> <span class="n">db</span> <span class="p">=</span> <span class="n">doc</span><span class="p">.</span><span class="n">Database</span><span class="p">;</span>
    <span class="n">Editor</span> <span class="n">ed</span> <span class="p">=</span> <span class="n">doc</span><span class="p">.</span><span class="n">Editor</span><span class="p">;</span>
    <span class="n">Point3d</span> <span class="n">issPoint3d</span> <span class="p">=</span> <span class="n">Point3d</span><span class="p">.</span><span class="n">Origin</span><span class="p">;</span>
    <span class="n">ObjectId</span> <span class="n">issId</span> <span class="p">=</span> <span class="n">ObjectId</span><span class="p">.</span><span class="n">Null</span><span class="p">;</span>
    <span class="n">ObjectId</span> <span class="n">componentId</span> <span class="p">=</span> <span class="n">ObjectId</span><span class="p">.</span><span class="n">Null</span><span class="p">;</span>
    <span class="kt">string</span> <span class="n">issPortName</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
    <span class="kt">string</span> <span class="n">componentPortName</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
    <span class="kt">string</span> <span class="n">issMsgString</span> <span class="p">=</span> <span class="n">tipGroup</span> <span class="p">+</span> <span class="s">@"\P"</span> <span class="p">+</span> <span class="n">tipNumber</span><span class="p">;</span>
    <span class="c1">// Get the sphere block to insert at the iss point</span>
    <span class="n">ObjectId</span> <span class="n">issBlockId</span> <span class="p">=</span> <span class="nf">CreateTieInPointIssBlock</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">issBlockId</span> <span class="p">==</span> <span class="n">ObjectId</span><span class="p">.</span><span class="n">Null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">AcadApp</span>
            <span class="p">.</span><span class="nf">ShowAlertDialog</span><span class="p">(</span><span class="s">"Error: Failed to get Tie-In Point blockId.\nPlease make sure you are in the World Coordinate System (UCS ‘W'"</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">ObjectId</span><span class="p">.</span><span class="n">Null</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">Autodesk</span><span class="p">.</span><span class="n">AutoCAD</span><span class="p">.</span><span class="n">Internal</span><span class="p">.</span><span class="n">Utils</span><span class="p">.</span><span class="nf">SetFocusToDwgView</span><span class="p">();</span>
    <span class="c1">// save osmode to reset when done</span>
    <span class="n">Object</span> <span class="n">origOsmode</span> <span class="p">=</span> <span class="n">AcadApp</span><span class="p">.</span><span class="nf">GetSystemVariable</span><span class="p">(</span><span class="s">"osmode"</span><span class="p">);</span>
    <span class="c1">// set osmode to ‘node’ only</span>
    <span class="n">AcadApp</span><span class="p">.</span><span class="nf">SetSystemVariable</span><span class="p">(</span><span class="s">"OSMODE"</span><span class="p">,</span> <span class="m">8</span><span class="p">);</span>
    <span class="c1">// Get the iss insertion point</span>
    <span class="n">PromptPointResult</span> <span class="n">pPtRes</span><span class="p">;</span>
    <span class="n">PromptPointOptions</span> <span class="n">pPtOpts</span> <span class="p">=</span>
        <span class="k">new</span> <span class="nf">PromptPointOptions</span><span class="p">(</span><span class="s">"\nSelect the Tie-In Point location: "</span><span class="p">);</span>
    <span class="n">pPtRes</span> <span class="p">=</span> <span class="n">doc</span><span class="p">.</span><span class="n">Editor</span><span class="p">.</span><span class="nf">GetPoint</span><span class="p">(</span><span class="n">pPtOpts</span><span class="p">);</span>
    <span class="n">issPoint3d</span> <span class="p">=</span> <span class="n">pPtRes</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
    <span class="n">ed</span><span class="p">.</span><span class="nf">WriteMessage</span><span class="p">(</span><span class="s">"\n"</span><span class="p">);</span>
    <span class="c1">// restore original osmode</span>
    <span class="n">AcadApp</span><span class="p">.</span><span class="nf">SetSystemVariable</span><span class="p">(</span><span class="s">"OSMODE"</span><span class="p">,</span> <span class="n">origOsmode</span><span class="p">);</span>
    <span class="c1">// Find a component with port at selected point location</span>
    <span class="n">Dictionary</span> <span class="n">partsPointsCoordsDict</span> <span class="p">=</span>
        <span class="n">MiscUtilities</span><span class="p">.</span><span class="nf">GetPartPointsCoordsDict</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">partsPointsCoordsDict</span><span class="p">.</span><span class="nf">ContainsKey</span><span class="p">(</span><span class="n">issPoint3d</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">AcadApp</span>
            <span class="p">.</span><span class="nf">ShowAlertDialog</span><span class="p">(</span><span class="s">"Error: Could not get Tie-In Point location.\n\n Please verify the following:\n"</span> <span class="p">+</span>
            <span class="s">" – You are in WCS.\n – You are choosing the node of a piping component.\n"</span> <span class="p">+</span>
            <span class="s">" – You are choosing a component in the current drawing (not Xref)."</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">ObjectId</span><span class="p">.</span><span class="n">Null</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">componentId</span> <span class="p">=</span> <span class="n">partsPointsCoordsDict</span><span class="p">[</span><span class="n">issPoint3d</span><span class="p">];</span>
    <span class="k">using</span> <span class="p">(</span><span class="n">DocumentLock</span> <span class="n">lockDoc</span> <span class="p">=</span> <span class="n">doc</span><span class="p">.</span><span class="nf">LockDocument</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="k">using</span> <span class="p">(</span><span class="n">Transaction</span> <span class="n">tr</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">TransactionManager</span><span class="p">.</span><span class="nf">StartTransaction</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">try</span>
            <span class="p">{</span>
                <span class="c1">// Create the iss symbol and add a symbolic port ——————————————————————–</span>
                <span class="n">IsoSphereSymbol</span> <span class="n">iss</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">IsoSphereSymbol</span><span class="p">();</span>
                <span class="n">iss</span><span class="p">.</span><span class="n">Position</span> <span class="p">=</span> <span class="n">issPoint3d</span><span class="p">;</span>
                <span class="n">iss</span><span class="p">.</span><span class="n">Radius</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
                <span class="n">iss</span><span class="p">.</span><span class="n">Layer</span> <span class="p">=</span> <span class="nf">GetTieInPointsLayer</span><span class="p">();</span>
                <span class="n">Port</span> <span class="n">issPort</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Port</span><span class="p">();</span>
                <span class="n">issPort</span><span class="p">.</span><span class="n">IsSymbolic</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
                <span class="n">issPort</span><span class="p">.</span><span class="n">Position</span> <span class="p">=</span> <span class="n">issPoint3d</span><span class="p">;</span>
                <span class="n">issPort</span><span class="p">.</span><span class="n">Direction</span> <span class="p">=</span> <span class="p">(</span><span class="k">new</span> <span class="nf">Vector3d</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">));</span>
                <span class="n">issPortName</span> <span class="p">=</span> <span class="s">"Symbolic"</span><span class="p">;</span>
                <span class="n">issPort</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="n">issPortName</span><span class="p">;</span>
                <span class="n">iss</span><span class="p">.</span><span class="nf">AddPort</span> <span class="p">(</span><span class="n">issPort</span><span class="p">);</span>
                <span class="n">iss</span><span class="p">.</span><span class="n">BlockId</span> <span class="p">=</span> <span class="n">issBlockId</span><span class="p">;</span>
                <span class="n">BlockTable</span> <span class="n">bt</span> <span class="p">=</span>
                    <span class="p">(</span><span class="n">BlockTable</span><span class="p">)</span>
                    <span class="n">tr</span>
                        <span class="p">.</span><span class="nf">GetObject</span><span class="p">(</span><span class="n">doc</span><span class="p">.</span><span class="n">Database</span><span class="p">.</span><span class="n">BlockTableId</span><span class="p">,</span>
                        <span class="n">OpenMode</span><span class="p">.</span><span class="n">ForRead</span><span class="p">);</span>
                <span class="n">BlockTableRecord</span> <span class="n">btr</span> <span class="p">=</span>
                    <span class="p">(</span><span class="n">BlockTableRecord</span><span class="p">)</span>
                    <span class="n">tr</span>
                        <span class="p">.</span><span class="nf">GetObject</span><span class="p">(</span><span class="n">bt</span><span class="p">[</span><span class="n">BlockTableRecord</span><span class="p">.</span><span class="n">ModelSpace</span><span class="p">],</span>
                        <span class="n">OpenMode</span><span class="p">.</span><span class="n">ForWrite</span><span class="p">);</span>
                <span class="n">btr</span><span class="p">.</span><span class="nf">AppendEntity</span> <span class="p">(</span><span class="n">iss</span><span class="p">);</span>
                <span class="n">tr</span><span class="p">.</span><span class="nf">AddNewlyCreatedDBObject</span><span class="p">(</span><span class="n">iss</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
                <span class="n">issId</span> <span class="p">=</span> <span class="n">iss</span><span class="p">.</span><span class="n">ObjectId</span><span class="p">;</span>
                <span class="c1">// Add a symbolic port the the host piping component ———————————————————————</span>
                <span class="n">Part</span> <span class="n">component</span> <span class="p">=</span>
                    <span class="p">(</span><span class="n">Part</span><span class="p">)</span> <span class="n">tr</span><span class="p">.</span><span class="nf">GetObject</span><span class="p">(</span><span class="n">componentId</span><span class="p">,</span> <span class="n">OpenMode</span><span class="p">.</span><span class="n">ForWrite</span><span class="p">);</span>
                <span class="n">Port</span> <span class="n">componentPort</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Port</span><span class="p">();</span>
                <span class="n">componentPort</span><span class="p">.</span><span class="n">IsSymbolic</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
                <span class="n">componentPortName</span> <span class="p">=</span>
                    <span class="n">component</span><span class="p">.</span><span class="nf">GenerateDynamicPortName</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
                <span class="n">componentPort</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="n">componentPortName</span><span class="p">;</span>
                <span class="n">componentPort</span><span class="p">.</span><span class="n">Position</span> <span class="p">=</span> <span class="n">issPoint3d</span><span class="p">;</span>
                <span class="n">componentPort</span><span class="p">.</span><span class="n">Direction</span> <span class="p">=</span> <span class="p">(</span><span class="k">new</span> <span class="nf">Vector3d</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="p">-</span><span class="m">1</span><span class="p">));</span>
                <span class="n">component</span><span class="p">.</span><span class="nf">AddPort</span> <span class="p">(</span><span class="n">componentPort</span><span class="p">);</span>
                <span class="c1">// Create port pairs and connect them ————————————————————————————–</span>
                <span class="n">ConnectionManager</span> <span class="n">cm</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConnectionManager</span><span class="p">();</span>
                <span class="n">Part</span> <span class="n">issPart</span> <span class="p">=</span>
                    <span class="n">tr</span><span class="p">.</span><span class="nf">GetObject</span><span class="p">(</span><span class="n">issId</span><span class="p">,</span> <span class="n">OpenMode</span><span class="p">.</span><span class="n">ForRead</span><span class="p">)</span> <span class="k">as</span>
                    <span class="n">Autodesk</span><span class="p">.</span><span class="n">ProcessPower</span><span class="p">.</span><span class="n">PnP3dObjects</span><span class="p">.</span><span class="n">Part</span><span class="p">;</span>
                <span class="n">Part</span> <span class="n">componentPart</span> <span class="p">=</span>
                    <span class="n">tr</span>
                        <span class="p">.</span><span class="nf">GetObject</span><span class="p">(</span><span class="n">component</span><span class="p">.</span><span class="n">ObjectId</span><span class="p">,</span>
                        <span class="n">OpenMode</span><span class="p">.</span><span class="n">ForRead</span><span class="p">)</span> <span class="k">as</span>
                    <span class="n">Autodesk</span><span class="p">.</span><span class="n">ProcessPower</span><span class="p">.</span><span class="n">PnP3dObjects</span><span class="p">.</span><span class="n">Part</span><span class="p">;</span>
                <span class="c1">// Fetch ports information</span>
                <span class="n">Autodesk</span><span class="p">.</span><span class="n">ProcessPower</span><span class="p">.</span><span class="n">PnP3dObjects</span><span class="p">.</span><span class="n">PortCollection</span> <span class="n">issPorts</span> <span class="p">=</span>
                    <span class="n">issPart</span><span class="p">.</span><span class="nf">GetPorts</span><span class="p">(</span><span class="n">PortType</span><span class="p">.</span><span class="n">Symbolic</span><span class="p">);</span>
                <span class="n">Autodesk</span><span class="p">.</span><span class="n">ProcessPower</span><span class="p">.</span><span class="n">PnP3dObjects</span><span class="p">.</span><span class="n">PortCollection</span> <span class="n">connectorPorts</span> <span class="p">=</span>
                    <span class="n">componentPart</span><span class="p">.</span><span class="nf">GetPorts</span><span class="p">(</span><span class="n">PortType</span><span class="p">.</span><span class="n">Symbolic</span><span class="p">);</span>
                <span class="c1">// Create port pairs and connect them</span>
                <span class="n">Pair</span> <span class="n">issPair</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Pair</span><span class="p">();</span>
                <span class="n">issPair</span><span class="p">.</span><span class="n">Port</span> <span class="p">=</span> <span class="n">issPorts</span><span class="p">[</span><span class="n">issPortName</span><span class="p">];</span>
                <span class="n">issPair</span><span class="p">.</span><span class="n">ObjectId</span> <span class="p">=</span> <span class="n">issId</span><span class="p">;</span>
                <span class="n">Pair</span> <span class="n">componentPair</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Pair</span><span class="p">();</span>
                <span class="n">componentPair</span><span class="p">.</span><span class="n">Port</span> <span class="p">=</span> <span class="n">connectorPorts</span><span class="p">[</span><span class="n">componentPortName</span><span class="p">];</span>
                <span class="n">componentPair</span><span class="p">.</span><span class="n">ObjectId</span> <span class="p">=</span> <span class="n">componentId</span><span class="p">;</span>
                <span class="n">cm</span><span class="p">.</span><span class="nf">Connect</span> <span class="p">(</span><span class="n">issPair</span><span class="p">,</span> <span class="n">componentPair</span><span class="p">);</span>
                <span class="c1">// Cancel the transaction and return NULL if the iss did not connect</span>
                <span class="k">if</span> <span class="p">(!</span><span class="n">cm</span><span class="p">.</span><span class="nf">IsConnected</span><span class="p">(</span><span class="n">issPair</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">ed</span>
                        <span class="p">.</span><span class="nf">WriteMessage</span><span class="p">(</span><span class="s">"Error: Could not connect tie-in point!"</span><span class="p">);</span>
                    <span class="n">tr</span><span class="p">.</span><span class="nf">Abort</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="c1">// Create the Tie-In Point tag ———————————————————————————————-</span>
                <span class="n">ObjectId</span> <span class="n">mleaderId</span> <span class="p">=</span>
                    <span class="nf">TagTieInPoint</span><span class="p">(</span><span class="n">issId</span><span class="p">,</span> <span class="n">tipGroup</span><span class="p">,</span> <span class="n">tipNumber</span><span class="p">);</span>
                <span class="c1">// set the iso message ——————————————————————————————————</span>
                <span class="n">Entity</span> <span class="n">ent</span> <span class="p">=</span>
                    <span class="n">tr</span>
                        <span class="p">.</span><span class="nf">GetObject</span><span class="p">(</span><span class="n">iss</span><span class="p">.</span><span class="n">ObjectId</span><span class="p">,</span>
                        <span class="n">OpenMode</span><span class="p">.</span><span class="n">ForRead</span><span class="p">,</span>
                        <span class="k">false</span><span class="p">,</span>
                        <span class="k">true</span><span class="p">)</span> <span class="k">as</span>
                    <span class="n">Entity</span><span class="p">;</span>
                <span class="c1">// Create the ExtensionDictionary if it does not exist</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ent</span><span class="p">.</span><span class="n">ExtensionDictionary</span><span class="p">.</span><span class="n">IsValid</span> <span class="p">!=</span> <span class="k">true</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">ent</span><span class="p">.</span><span class="nf">UpgradeOpen</span><span class="p">();</span>
                    <span class="n">ent</span><span class="p">.</span><span class="nf">CreateExtensionDictionary</span><span class="p">();</span>
                    <span class="n">ent</span><span class="p">.</span><span class="nf">DowngradeOpen</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ent</span><span class="p">.</span><span class="n">ExtensionDictionary</span><span class="p">.</span><span class="n">IsValid</span> <span class="p">==</span> <span class="k">true</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">ResultBuffer</span> <span class="n">rb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ResultBuffer</span><span class="p">();</span>
                    <span class="n">Xrecord</span> <span class="n">xRec</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Xrecord</span><span class="p">();</span>
                    <span class="n">DBDictionary</span> <span class="n">extDict</span> <span class="p">=</span>
                        <span class="p">(</span><span class="n">DBDictionary</span><span class="p">)</span>
                        <span class="n">tr</span>
                            <span class="p">.</span><span class="nf">GetObject</span><span class="p">(</span><span class="n">ent</span><span class="p">.</span><span class="n">ExtensionDictionary</span><span class="p">,</span>
                            <span class="n">OpenMode</span><span class="p">.</span><span class="n">ForWrite</span><span class="p">);</span>
                    <span class="c1">// Add issType XRec</span>
                    <span class="n">rb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ResultBuffer</span><span class="p">();</span>
                    <span class="n">rb</span>
                        <span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">TypedValue</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span> <span class="n">DxfCode</span><span class="p">.</span><span class="n">Text</span><span class="p">,</span>
                            <span class="s">"TieInPoint"</span><span class="p">));</span>
                    <span class="n">xRec</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Xrecord</span><span class="p">();</span>
                    <span class="n">xRec</span><span class="p">.</span><span class="n">Data</span> <span class="p">=</span> <span class="n">rb</span><span class="p">;</span>
                    <span class="n">extDict</span><span class="p">.</span><span class="nf">SetAt</span><span class="p">(</span><span class="s">"issType"</span><span class="p">,</span> <span class="n">xRec</span><span class="p">);</span>
                    <span class="n">tr</span><span class="p">.</span><span class="nf">AddNewlyCreatedDBObject</span><span class="p">(</span><span class="n">xRec</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
                    <span class="c1">// Set PnP3dMsg XRec</span>
                    <span class="n">rb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ResultBuffer</span><span class="p">();</span>
                    <span class="n">rb</span>
                        <span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">TypedValue</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span> <span class="n">DxfCode</span><span class="p">.</span><span class="n">Text</span><span class="p">,</span>
                            <span class="n">issMsgString</span><span class="p">));</span>
                    <span class="n">xRec</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Xrecord</span><span class="p">();</span>
                    <span class="n">xRec</span><span class="p">.</span><span class="n">Data</span> <span class="p">=</span> <span class="n">rb</span><span class="p">;</span>
                    <span class="n">extDict</span><span class="p">.</span><span class="nf">SetAt</span><span class="p">(</span><span class="s">"PnP3dMsg"</span><span class="p">,</span> <span class="n">xRec</span><span class="p">);</span>
                    <span class="n">tr</span><span class="p">.</span><span class="nf">AddNewlyCreatedDBObject</span><span class="p">(</span><span class="n">xRec</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
                    <span class="c1">// Set mleader objectId XRec</span>
                    <span class="n">rb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ResultBuffer</span><span class="p">();</span>
                    <span class="n">rb</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">TypedValue</span><span class="p">(</span><span class="m">330</span><span class="p">,</span> <span class="n">mleaderId</span><span class="p">));</span>
                    <span class="n">xRec</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Xrecord</span><span class="p">();</span>
                    <span class="n">xRec</span><span class="p">.</span><span class="n">Data</span> <span class="p">=</span> <span class="n">rb</span><span class="p">;</span>
                    <span class="n">extDict</span><span class="p">.</span><span class="nf">SetAt</span><span class="p">(</span><span class="s">"mleaderObjId"</span><span class="p">,</span> <span class="n">xRec</span><span class="p">);</span>
                    <span class="n">tr</span><span class="p">.</span><span class="nf">AddNewlyCreatedDBObject</span><span class="p">(</span><span class="n">xRec</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
                    <span class="n">extDict</span><span class="p">.</span><span class="nf">DowngradeOpen</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">catch</span>
            <span class="p">{</span>
                <span class="n">AcadApp</span>
                    <span class="p">.</span><span class="nf">ShowAlertDialog</span><span class="p">(</span><span class="s">"Error: Could not add Tie-In Point."</span><span class="p">);</span>
                <span class="n">tr</span><span class="p">.</span><span class="nf">Abort</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="n">tr</span><span class="p">.</span><span class="nf">Commit</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// Error if valid ObjectId not returned</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">issId</span> <span class="p">==</span> <span class="n">ObjectId</span><span class="p">.</span><span class="n">Null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">AcadApp</span>
            <span class="p">.</span><span class="nf">ShowAlertDialog</span><span class="p">(</span><span class="s">"Error: Could not get Tie-In Point location.\n\n Please verify the following:\n"</span> <span class="p">+</span>
            <span class="s">" – You are in WCS.\n – You are choosing the node of a piping component.\n"</span> <span class="p">+</span>
            <span class="s">" – You are choosing a component in the current drawing (not Xref)."</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">issId</span><span class="p">;</span>
<span class="p">}</span>


<span class="c1">// Tap port example:</span>
<span class="c1">// Add a dynamic port the the host piping component</span>
<span class="n">Port</span> <span class="n">tapPort</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Port</span><span class="p">();</span>
<span class="n">tapPort</span><span class="p">.</span><span class="n">EndType</span> <span class="p">=</span> <span class="s">"TAP"</span><span class="p">;</span>
<span class="n">tapPort</span><span class="p">.</span><span class="n">EngagementLength</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
<span class="n">tapPort</span><span class="p">.</span><span class="n">IsDynamic</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
<span class="n">tapPort</span><span class="p">.</span><span class="n">IsSymbolic</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
<span class="n">tapPort</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="n">tapPortName</span><span class="p">;</span>
<span class="n">tapPort</span><span class="p">.</span><span class="n">NominalDiameter</span> <span class="p">=</span> <span class="n">partDef</span><span class="p">.</span><span class="n">MainNomDiam</span><span class="p">;</span>
<span class="n">tapPort</span><span class="p">.</span><span class="n">Position</span> <span class="p">=</span> <span class="n">partDef</span><span class="p">.</span><span class="n">TapPoint</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">partDef</span><span class="p">.</span><span class="n">IsBranchEol</span><span class="p">)</span>
<span class="n">tapPort</span><span class="p">.</span><span class="n">Direction</span> <span class="p">=</span> <span class="n">partDef</span><span class="p">.</span><span class="n">MainVector</span><span class="p">;</span>
<span class="k">else</span>
<span class="n">tapPort</span><span class="p">.</span><span class="n">Direction</span> <span class="p">=</span> <span class="n">partDef</span><span class="p">.</span><span class="n">BranchVector</span><span class="p">;</span>

<span class="n">part</span><span class="p">.</span><span class="nf">UpgradeOpen</span><span class="p">();</span>
<span class="n">part</span><span class="p">.</span><span class="nf">AddPort</span><span class="p">(</span><span class="n">tapPort</span><span class="p">);</span>
</pre></td>
</tr></tbody></table></code></div></div>
</div>
<div class="post-tail-wrapper text-muted">
<div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href="/categories/lisp/">Lisp</a>, <a href="/categories/plant-3d/">Plant 3D</a>
</div>
<div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/activex/" class="post-tag no-text-decoration">ActiveX</a> <a href="/tags/autocad/" class="post-tag no-text-decoration">AutoCAD</a> <a href="/tags/iso-message/" class="post-tag no-text-decoration">Iso Message</a> <a href="/tags/iso-sphere/" class="post-tag no-text-decoration">Iso Sphere</a> <a href="/tags/isomessage/" class="post-tag no-text-decoration">IsoMessage</a> <a href="/tags/isosphere/" class="post-tag no-text-decoration">IsoSphere</a> <a href="/tags/vla-object/" class="post-tag no-text-decoration">VLA-OBJECT</a> <a href="/tags/xrecord/" class="post-tag no-text-decoration">XRecord</a>
</div>
<div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
<div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener noreferrer">CC BY 4.0</a> by the author.</div>
<div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span>
</div>
</div>
</div>
</div></div>
<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access">
<div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/accessing-fabricaton-items-through-net/">Accessing Fabricaton Items Through .NET</a></li></ul>
</div>
<div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/autocad/">AutoCAD</a> <a class="post-tag" href="/tags/fabrication/">Fabrication</a> <a class="post-tag" href="/tags/vla/">VLA</a> <a class="post-tag" href="/tags/lisp/">Lisp</a> <a class="post-tag" href="/tags/visual-lisp/">Visual Lisp</a> <a class="post-tag" href="/tags/activex/">ActiveX</a> <a class="post-tag" href="/tags/automation/">Automation</a> <a class="post-tag" href="/tags/cadmep/">cadMEP</a> <a class="post-tag" href="/tags/command/">command</a> <a class="post-tag" href="/tags/fabrication-api/">Fabrication API</a>
</div>
</div>
</div></div>
</div>
<div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
<div id="related-posts" class="mt-5 mb-2 mb-sm-4">
<h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3>
<div class="card-deck mb-4">
<div class="card"> <a href="/posts/autodesk-fabrication-vla-properties-exposed/"><div class="card-body"> <span class="timeago small"> Oct 30, 2016 <i class="unloaded">2016-10-30T23:38:00-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Autodesk Fabrication - VLA Properties Exposed</h3>
<div class="text-muted small"><p> In the 2000 release of AutoCAD we saw the introduction of Visual Lisp and it was very large leap forward that I couldn’t possibly convey the magnitude of its importance. This release brought Lisp w...</p></div>
</div></a>
</div>
<div class="card"> <a href="/posts/2019-autocad-r-i-p-fbximport/"><div class="card-body"> <span class="timeago small"> Sep 7, 2018 <i class="unloaded">2018-09-07T00:38:00-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>2019 Autocad - R.I.P. FBXIMPORT</h3>
<div class="text-muted small"><p> Sorry to go fairly dark for a while, but  I think Andy said it best. “Being asked to accomplish seemingly impossible goals on a regular basis is just what we do, but these days it feels more like t...</p></div>
</div></a>
</div>
<div class="card"> <a href="/posts/notepad-udl-highlighting-for-cod-dcl-languages/"><div class="card-body"> <span class="timeago small"> Mar 23, 2019 <i class="unloaded">2019-03-23T21:32:00-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Notepad++ UDL Highlighting for COD &amp; DCL Languages</h3>
<div class="text-muted small"><p> Dialog Control Language UDL We had a DLL AutoCAD command that we lost the code to quite some time ago and wanted to “update” its functionality. We could have done this through lisp quite easily, bu...</p></div>
</div></a>
</div>
</div>
</div>
<div class="post-navigation d-flex justify-content-between"> <a href="/posts/visualizing-your-data-with-s-tupid-s-imple-t-ables/" class="btn btn-outline-primary" prompt="Older"><p>Visualizing your data with S.tupid S.imple T.ables</p></a> <a href="/posts/2019-autocad-r-i-p-fbximport/" class="btn btn-outline-primary" prompt="Newer"><p>2019 Autocad - R.I.P. FBXIMPORT</p></a>
</div>
</div></div></div>
<footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center">
<div class="footer-left"><p class="mb-0"> © 2022 <a href="https://www.linkedin.com/in/andrew-hepker-738b0b80/" target="_blank" rel="noopener noreferrer">House of BIM</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div>
<div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener noreferrer">Chirpy</a> theme.</p></div>
</div></footer>
</div>
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content">
<div id="search-hints">
<h4 class="text-muted mb-4">Trending Tags</h4>
<a class="post-tag" href="/tags/autocad/">AutoCAD</a> <a class="post-tag" href="/tags/fabrication/">Fabrication</a> <a class="post-tag" href="/tags/vla/">VLA</a> <a class="post-tag" href="/tags/lisp/">Lisp</a> <a class="post-tag" href="/tags/visual-lisp/">Visual Lisp</a> <a class="post-tag" href="/tags/activex/">ActiveX</a> <a class="post-tag" href="/tags/automation/">Automation</a> <a class="post-tag" href="/tags/cadmep/">cadMEP</a> <a class="post-tag" href="/tags/command/">command</a> <a class="post-tag" href="/tags/fabrication-api/">Fabrication API</a>
</div>
<div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
</div></div>
</div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
