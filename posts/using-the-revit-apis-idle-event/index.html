<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Using the Revit API’s Idle Event" /><meta name="author" content="homeofbim" /><meta property="og:locale" content="en_US" /><meta name="description" content="I’ve been digging into the Revit API a lot lately. I am not a Revit true-believer yet, but I give credit where its due and so far the Revit API has been quite impressive. It is lacking a lot of things, but generally you can work around them one way or another. One such pain that many of us encounter is a limited number of places you can actually do work. Which again, isn’t a big deal, but I do see a lot of people complaining about having super bloated idle events. I have no idea if someone else has a better way to solve this, but I for one hit the problem and went back to working on my long term goals 20 minutes later after coming up with the method I am presenting. So, maybe there is a better way running around, but since I keep seeing the same dialog, I thought I’d post how I chose to handle postable and/or modeless dialog command issues. It is a system that works pretty well for me because I can cue up stuff to happen, those things can do work, then cue up more stuff to happen and I’ve actually been able to nest that process 4 or 5 deep with no issues." /><meta property="og:description" content="I’ve been digging into the Revit API a lot lately. I am not a Revit true-believer yet, but I give credit where its due and so far the Revit API has been quite impressive. It is lacking a lot of things, but generally you can work around them one way or another. One such pain that many of us encounter is a limited number of places you can actually do work. Which again, isn’t a big deal, but I do see a lot of people complaining about having super bloated idle events. I have no idea if someone else has a better way to solve this, but I for one hit the problem and went back to working on my long term goals 20 minutes later after coming up with the method I am presenting. So, maybe there is a better way running around, but since I keep seeing the same dialog, I thought I’d post how I chose to handle postable and/or modeless dialog command issues. It is a system that works pretty well for me because I can cue up stuff to happen, those things can do work, then cue up more stuff to happen and I’ve actually been able to nest that process 4 or 5 deep with no issues." /><link rel="canonical" href="/posts/using-the-revit-apis-idle-event/" /><meta property="og:url" content="/posts/using-the-revit-apis-idle-event/" /><meta property="og:site_name" content="House of BIM" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-03-01T23:38:00-07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Using the Revit API’s Idle Event" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"headline":"Using the Revit API’s Idle Event","dateModified":"2020-03-01T23:38:00-07:00","datePublished":"2020-03-01T23:38:00-07:00","description":"I’ve been digging into the Revit API a lot lately. I am not a Revit true-believer yet, but I give credit where its due and so far the Revit API has been quite impressive. It is lacking a lot of things, but generally you can work around them one way or another. One such pain that many of us encounter is a limited number of places you can actually do work. Which again, isn’t a big deal, but I do see a lot of people complaining about having super bloated idle events. I have no idea if someone else has a better way to solve this, but I for one hit the problem and went back to working on my long term goals 20 minutes later after coming up with the method I am presenting. So, maybe there is a better way running around, but since I keep seeing the same dialog, I thought I’d post how I chose to handle postable and/or modeless dialog command issues. It is a system that works pretty well for me because I can cue up stuff to happen, those things can do work, then cue up more stuff to happen and I’ve actually been able to nest that process 4 or 5 deep with no issues.","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/using-the-revit-apis-idle-event/"},"url":"/posts/using-the-revit-apis-idle-event/","@type":"BlogPosting","author":{"@type":"Person","name":"homeofbim"},"@context":"https://schema.org"}</script><title>Using the Revit API's Idle Event | House of BIM</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end">
<div class="profile-wrapper text-center">
<div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/favicons/favicon-96x96.png" alt="avatar" onerror="this.style.display='none'"> </a>
</div>
<div class="site-title mt-3"> <a href="/">House of BIM</a>
</div>
<div class="site-subtitle font-italic">Stuff and Things...it's what we do</div>
</div>
<ul class="w-100">
<li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a>
</li>
<li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a>
</li>
<li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a>
</li>
<li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-database ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a>
</li>
<li class="nav-item"> <a href="/links/" class="nav-link"> <i class="fa-fw fa fa-link ml-xl-3 mr-xl-3 unloaded"></i> <span>LINKS</span> </a>
</li>
<li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fa fa-question ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a>
</li>
</ul>
<div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/AHepker-HOB" aria-label="github" class="order-3" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/andrew-hepker-738b0b80/" aria-label="linkedin" class="order-4" target="_blank" rel="noopener noreferrer"> <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href=%5B'mailto:',%20'andrew',%20'.',%20'hepker',%20'@house',%20'ofbim.com'%5D.join('')" aria-label="email" class="order-5"> <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6"> <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span>
</div>
</div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Using the Revit API's Idle Event</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div>
<i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel">Cancel</span>
</div></div><div id="main-wrapper">
<div id="main">
<div class="row">
<div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
<h1 data-toc-skip>Using the Revit API's Idle Event</h1>
<div class="post-meta text-muted d-flex flex-column">
<div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Mar 1, 2020, 11:38 PM -0700"> Mar 1, 2020 <i class="unloaded">2020-03-01T23:38:00-07:00</i> </span> by <span class="author"> homeofbim </span>
</div>
<div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1459 words">8 min</span>
</div>
</div>
<div class="post-content">
<p>I’ve been digging into the Revit API a lot lately. I am not a Revit true-believer yet, but I give credit where its due and so far the Revit API has been quite impressive. It is lacking a lot of things, but generally you can work around them one way or another. One such pain that many of us encounter is a limited number of places you can actually do work. Which again, isn’t a big deal, but I do see a lot of people complaining about having super bloated idle events. I have no idea if someone else has a better way to solve this, but I for one hit the problem and went back to working on my long term goals 20 minutes later after coming up with the method I am presenting. So, maybe there is a better way running around, but since I keep seeing the same dialog, I thought I’d post how I chose to handle postable and/or modeless dialog command issues. It is a system that works pretty well for me because I can cue up stuff to happen, those things can do work, then cue up more stuff to happen and I’ve actually been able to nest that process 4 or 5 deep with no issues.</p>
<h2 id="my-idle-event">My Idle Event</h2>
<p>Yes, this is all of it:</p>
<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td>
<td class="rouge-code"><pre><span class="k">private</span> <span class="k">void</span> <span class="nf">UiApp_Idling</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RUI</span><span class="p">.</span><span class="n">Events</span><span class="p">.</span><span class="n">IdlingEventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">sender</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">DelegatedTasks</span><span class="p">.</span><span class="n">Cue</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;=</span> <span class="m">1</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">DelegatedTasks</span><span class="p">.</span><span class="n">Cue</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
      <span class="p">{</span> <span class="n">DelegatedTasks</span><span class="p">.</span><span class="n">Cue</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">Eval</span><span class="p">(</span><span class="n">sender</span> <span class="k">as</span> <span class="n">RUI</span><span class="p">.</span><span class="n">UIApplication</span><span class="p">);</span> <span class="p">}</span>
    <span class="n">DelegatedTasks</span><span class="p">.</span><span class="n">Cue</span> <span class="p">=</span> <span class="n">DelegatedTasks</span><span class="p">.</span><span class="n">Cue</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">Completed</span> <span class="p">==</span> <span class="k">false</span><span class="p">).</span><span class="nf">ToList</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div></div>
<p>The above code is referencing a static class <code class="language-plaintext highlighter-rouge">DelegatedTasks</code> containing a static <code class="language-plaintext highlighter-rouge">List&lt;DeferredRevitTask&gt;</code> custom objects variable named Cue. I realize Queue would probably be more accurate, but I like meaningful mini variables. In this same class you <em>could</em> also add static void methods that take a UIApplication and a DefferedRevitTask as arguments. These methods represent the code you want to run later during an idle event. As a rule, you should make these static, but other than that any method taking those two arguments in that order should do. This means our “<em>out of context</em>” code only needs to know of a method that could perform the task they want done, but other than that, its work is finished as soon as it supplies that delegate to our static Cue variable. When Revit “can” do work and “if” your provided AwaitedAction conditions are met, then it will go do stuff…</p>
<p><strong><em>Note:</em></strong> The FOR loop is important. You wouldn’t want to FOREACH through that list or else you wouldn’t have the ability to cue up new tasks from within a delegated method.</p>
<h2 id="deferred-tasks">Deferred Tasks</h2>
<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre></td>
<td class="rouge-code"><pre><span class="k">public</span> <span class="k">delegate</span> <span class="k">void</span> <span class="nf">EvalEvent</span><span class="p">(</span><span class="n">RUI</span><span class="p">.</span><span class="n">UIApplication</span> <span class="n">uiApp</span><span class="p">,</span> <span class="n">DeferredRevitTask</span> <span class="n">e</span><span class="p">);</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">DeferredRevitTask</span>
<span class="p">{</span>
  <span class="k">private</span> <span class="n">EvalEvent</span> <span class="n">Handler</span><span class="p">;</span>
  <span class="k">public</span> <span class="n">AwaitedActionBase</span> <span class="n">Args</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
  <span class="k">public</span> <span class="kt">bool</span> <span class="n">Completed</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
  
  <span class="k">public</span> <span class="nf">DeferredRevitTask</span><span class="p">(</span><span class="n">EvalEvent</span> <span class="n">callback</span><span class="p">,</span> <span class="n">AwaitedActionBase</span> <span class="n">data</span><span class="p">)</span>
  <span class="p">{</span> <span class="n">Handler</span> <span class="p">=</span> <span class="n">callback</span><span class="p">;</span> <span class="n">Args</span> <span class="p">=</span> <span class="n">data</span><span class="p">;</span> <span class="p">}</span>

  <span class="k">public</span> <span class="k">void</span> <span class="nf">Eval</span><span class="p">(</span><span class="n">RUI</span><span class="p">.</span><span class="n">UIApplication</span> <span class="n">app</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Args</span><span class="p">.</span><span class="nf">isReady</span><span class="p">(</span><span class="n">app</span><span class="p">)</span> <span class="p">==</span> <span class="k">true</span><span class="p">)</span>
    <span class="p">{</span> <span class="nf">Handler</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">AwaitedActionBase</span>
<span class="p">{</span> 
  <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;</span> <span class="n">Data</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;();</span>
  <span class="k">public</span> <span class="kt">int</span> <span class="n">Interval</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
  <span class="k">public</span> <span class="nf">AwaitedActionBase</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
  <span class="k">public</span> <span class="k">abstract</span> <span class="kt">bool</span> <span class="nf">isReady</span><span class="p">(</span><span class="n">RUI</span><span class="p">.</span><span class="n">UIApplication</span> <span class="n">app</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">TimeAwaitedAction</span> <span class="p">:</span> <span class="n">AwaitedActionBase</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="n">DateTime</span> <span class="n">Started</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">;</span>
  <span class="k">public</span> <span class="nf">TimeAwaitedAction</span><span class="p">(</span><span class="kt">int</span> <span class="n">TimeUntilExec</span><span class="p">,</span> <span class="k">params</span> <span class="kt">object</span><span class="p">[]</span> <span class="n">data</span><span class="p">)</span>
  <span class="p">{</span> <span class="n">Data</span><span class="p">.</span><span class="nf">AddRange</span><span class="p">(</span><span class="n">data</span><span class="p">);</span> <span class="n">Interval</span> <span class="p">=</span> <span class="n">TimeUntilExec</span><span class="p">;</span> <span class="p">}</span>

  <span class="k">public</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">isReady</span><span class="p">(</span><span class="n">RUI</span><span class="p">.</span><span class="n">UIApplication</span> <span class="n">app</span><span class="p">)</span>
  <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span> <span class="p">-</span> <span class="n">Started</span><span class="p">).</span><span class="n">TotalMilliseconds</span> <span class="p">&gt;=</span> <span class="n">Interval</span> <span class="p">?</span> <span class="k">true</span> <span class="p">:</span> <span class="k">false</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">CountAwaitedAction</span> <span class="p">:</span> <span class="n">AwaitedActionBase</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="kt">int</span> <span class="n">Count</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
  <span class="k">public</span> <span class="nf">CountAwaitedAction</span><span class="p">(</span><span class="kt">int</span> <span class="n">ExecOnCountOf</span><span class="p">,</span> <span class="k">params</span> <span class="kt">object</span><span class="p">[]</span> <span class="n">data</span><span class="p">)</span>
  <span class="p">{</span> <span class="n">Data</span><span class="p">.</span><span class="nf">AddRange</span><span class="p">(</span><span class="n">data</span><span class="p">);</span> <span class="n">Interval</span> <span class="p">=</span> <span class="n">ExecOnCountOf</span><span class="p">;</span> <span class="p">}</span>

  <span class="k">public</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">isReady</span><span class="p">(</span><span class="n">RUI</span><span class="p">.</span><span class="n">UIApplication</span> <span class="n">app</span><span class="p">)</span>
  <span class="p">{</span> <span class="k">return</span> <span class="p">++</span><span class="n">Count</span> <span class="p">&gt;=</span> <span class="n">Interval</span> <span class="p">?</span> <span class="k">true</span> <span class="p">:</span> <span class="k">false</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">FileAwaitedAction</span> <span class="p">:</span> <span class="n">AwaitedActionBase</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="kt">string</span> <span class="n">rvtPath</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
  <span class="k">public</span> <span class="nf">FileAwaitedAction</span><span class="p">(</span><span class="kt">string</span> <span class="n">path</span><span class="p">,</span> <span class="k">params</span> <span class="kt">object</span><span class="p">[]</span> <span class="n">data</span><span class="p">)</span>
  <span class="p">{</span> <span class="n">Data</span><span class="p">.</span><span class="nf">AddRange</span><span class="p">(</span><span class="n">data</span><span class="p">);</span> <span class="n">rvtPath</span> <span class="p">=</span> <span class="n">path</span><span class="p">;</span> <span class="p">}</span>

  <span class="k">public</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">isReady</span><span class="p">(</span><span class="n">RUI</span><span class="p">.</span><span class="n">UIApplication</span> <span class="n">app</span><span class="p">)</span>
  <span class="p">{</span> <span class="k">return</span> <span class="n">app</span><span class="p">.</span><span class="n">ActiveUIDocument</span><span class="p">.</span><span class="n">Document</span><span class="p">.</span><span class="n">PathName</span> <span class="p">==</span> <span class="n">rvtPath</span> <span class="p">?</span> <span class="k">true</span> <span class="p">:</span> <span class="k">false</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div></div>
<p>So, a deferred task is nothing more than a callback, a completion status and some kind of AwaitedAction. The awaited actions were designed to let me wait for a time period, execute on the n’th idle event or to do work when a specific file has been activated. Here are some examples of their utility:</p>
<ul>
<li>Time, this can be useful for hourly NWC creation or to force a scheduled Sync &amp; Save prior to when posting models are being built.</li>
<li>Count, this I probably use the most in conjunction with postable commands so I can let Revit do what it was intended to do before I swoop in and enhance whatever I am trying to polish.</li>
<li>File, this is useful if your trying to do work that requires another file to be opened temporarily and you want to pick up where you left off when the user closes out of that secondary file you activated.</li>
</ul>
<p>All the AwaitedAction constructors have a required context value that helps them determine when they should fire, but they also have a completely optional number of other parameters you can feed into them. So, if you are doing something where you want to pass what was selected at the time the user clicked a button on your modeless dialog, then you can do that.  You can send them each in as individual pieces of information, as a list of INT or whatever. All that matters is that the delegate method you make to pick up the slack knows what you were planning to send it.</p>
<p><strong><em>Note:</em></strong> The EVAL method is in charge of running the <code class="language-plaintext highlighter-rouge">isReady</code> test on the Awaited Task’s and will only execute their callback once the AwaitedTask criteria was met. It’s super low overhead that doesn’t seem to phase Revit in the slightest and it really shouldn’t since its only ever executing while Revit is theoretically doing absolutely nothing.</p>
<h2 id="deferred-methods">Deferred Methods</h2>
<p>Here is an example method that immediately sets its completed status to true and then converts the data I passed; which was a list of all GroupType names prior to me using a postable command to LoadGroup from file. So, next I am getting a new list of GroupType’s and then using WHERE Linq expression to find all the new ones, grabbing the last GroupType it found (that didn’t already exist) , inserting it, ungrouping the inserted instance and finally deleting the GroupType source reference. If I had used the postable LoadGroup and the user didn’t actually select something, then the GFL.COUNT wouldn’t have been greater than 1, no work would have been performed and the status still would have been set to completed = True. Which means my idle event (shown above) would have removed this Cue’d Task whether it did work or not….. Exactly what I want so that I don’t wind up with a bunch of cued tasks that will never do anything or worse one that do unintended things later…</p>
<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td>
<td class="rouge-code"><pre><span class="k">internal</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">GroupExploder</span><span class="p">(</span><span class="n">RUI</span><span class="p">.</span><span class="n">UIApplication</span> <span class="n">app</span><span class="p">,</span> <span class="n">DeferredRevitTask</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">e</span><span class="p">.</span><span class="n">Completed</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
  <span class="kt">var</span> <span class="n">existing</span> <span class="p">=</span> <span class="p">(</span><span class="n">IList</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;)</span><span class="n">e</span><span class="p">.</span><span class="n">Args</span><span class="p">.</span><span class="n">Data</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
  <span class="kt">var</span> <span class="n">Doc</span> <span class="p">=</span> <span class="n">app</span><span class="p">.</span><span class="n">ActiveUIDocument</span><span class="p">.</span><span class="n">Document</span><span class="p">;</span>
  <span class="kt">var</span> <span class="n">gfl</span> <span class="p">=</span> <span class="k">new</span> <span class="n">RDB</span><span class="p">.</span><span class="nf">FilteredElementCollector</span><span class="p">(</span><span class="n">Doc</span><span class="p">).</span><span class="nf">OfClass</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">RDB</span><span class="p">.</span><span class="n">GroupType</span><span class="p">)).</span><span class="nf">ToElements</span><span class="p">();</span>
  <span class="n">gfl</span> <span class="p">=</span> <span class="n">gfl</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="n">existing</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">Name</span><span class="p">)</span> <span class="p">==</span> <span class="k">false</span><span class="p">).</span><span class="nf">ToList</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">gfl</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;=</span> <span class="m">1</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">using</span> <span class="p">(</span><span class="n">RDB</span><span class="p">.</span><span class="n">Transaction</span> <span class="n">tr</span> <span class="p">=</span> <span class="k">new</span> <span class="n">RDB</span><span class="p">.</span><span class="nf">Transaction</span><span class="p">(</span><span class="n">Doc</span><span class="p">,</span> <span class="s">"GroupProccessor"</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="n">tr</span><span class="p">.</span><span class="nf">Start</span><span class="p">();</span>
      <span class="n">Doc</span><span class="p">.</span><span class="n">Create</span><span class="p">.</span><span class="nf">PlaceGroup</span><span class="p">(</span><span class="k">new</span> <span class="n">RDB</span><span class="p">.</span><span class="nf">XYZ</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span> <span class="n">gfl</span><span class="p">.</span><span class="nf">Last</span><span class="p">()</span> <span class="k">as</span> <span class="n">RDB</span><span class="p">.</span><span class="n">GroupType</span><span class="p">).</span><span class="nf">UngroupMembers</span><span class="p">();</span>
      <span class="n">Doc</span><span class="p">.</span><span class="nf">Delete</span><span class="p">(</span><span class="n">gfl</span><span class="p">.</span><span class="nf">Last</span><span class="p">().</span><span class="n">Id</span><span class="p">);</span>
      <span class="n">tr</span><span class="p">.</span><span class="nf">Commit</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div></div>
<h2 id="my-using-statments">My Using Statments</h2>
<p>The code above is using some shorthand using statements that generally make deep dark API’s a little easier to work with, but without entirely losing the context of where something is being referenced from.</p>
<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td>
<td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">RAT</span> <span class="p">=</span> <span class="n">Autodesk</span><span class="p">.</span><span class="n">Revit</span><span class="p">.</span><span class="n">Attributes</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">RDB</span> <span class="p">=</span> <span class="n">Autodesk</span><span class="p">.</span><span class="n">Revit</span><span class="p">.</span><span class="n">DB</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">RUI</span> <span class="p">=</span> <span class="n">Autodesk</span><span class="p">.</span><span class="n">Revit</span><span class="p">.</span><span class="n">UI</span><span class="p">;</span>
</pre></td>
</tr></tbody></table></code></div></div>
<h2 id="wrap-up">Wrap up</h2>
<p>Like I said, this popped into my head immediately after realizing the problem I was facing. There may be other solutions, but what I have here is working quite well for me and I put stuff like (deferred tasks) this in a (shared) DLL of its own that all my actual Revit command DLL’s (having the idle/deferred methods code) can just reference. I’d highly suggest doing something like that too.</p>
<p>Another intersting prospect, there is some kind of Revit arbitrary data store that I haven’t fully investigated, but if it is the same store for all users (updated on sync), then theoretically I could potentially add another cue in there dedicated to cueing events for other users to do certain things for me….</p>
</div>
<div class="post-tail-wrapper text-muted">
<div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href="/categories/net/">.NET</a>, <a href="/categories/revit/">Revit</a>
</div>
<div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/c/" class="post-tag no-text-decoration">C#</a> <a href="/tags/deferred-code/" class="post-tag no-text-decoration">Deferred Code</a> <a href="/tags/delegate/" class="post-tag no-text-decoration">Delegate</a> <a href="/tags/idle-event/" class="post-tag no-text-decoration">Idle Event</a> <a href="/tags/revit/" class="post-tag no-text-decoration">Revit</a> <a href="/tags/revit-api/" class="post-tag no-text-decoration">Revit API</a>
</div>
<div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
<div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener noreferrer">CC BY 4.0</a> by the author.</div>
<div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span>
</div>
</div>
</div>
</div></div>
<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">
<div class="access">
<div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/accessing-fabricaton-items-through-net/">Accessing Fabricaton Items Through .NET</a></li></ul>
</div>
<div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/autocad/">AutoCAD</a> <a class="post-tag" href="/tags/fabrication/">Fabrication</a> <a class="post-tag" href="/tags/vla/">VLA</a> <a class="post-tag" href="/tags/lisp/">Lisp</a> <a class="post-tag" href="/tags/visual-lisp/">Visual Lisp</a> <a class="post-tag" href="/tags/activex/">ActiveX</a> <a class="post-tag" href="/tags/automation/">Automation</a> <a class="post-tag" href="/tags/cadmep/">cadMEP</a> <a class="post-tag" href="/tags/command/">command</a> <a class="post-tag" href="/tags/fabrication-api/">Fabrication API</a>
</div>
</div>
</div>
<script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav>
</div>
</div>
</div>
<div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
<div id="related-posts" class="mt-5 mb-2 mb-sm-4">
<h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3>
<div class="card-deck mb-4">
<div class="card"> <a href="/posts/autodesk-university-2016-jhoward/"><div class="card-body"> <span class="timeago small"> Nov 20, 2016 <i class="unloaded">2016-11-20T16:30:00-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Autodesk University 2016 - Jhoward</h3>
<div class="text-muted small"><p> It was another fine AU conference and my head is spinning with new or even evolved ideas. I had a two classes that pretty much tanked, but despite being sore from the 30 miles of walking I did have...</p></div>
</div></a>
</div>
<div class="card"> <a href="/posts/2019-autocad-r-i-p-fbximport/"><div class="card-body"> <span class="timeago small"> Sep 7, 2018 <i class="unloaded">2018-09-07T00:38:00-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>2019 Autocad - R.I.P. FBXIMPORT</h3>
<div class="text-muted small"><p> Sorry to go fairly dark for a while, but  I think Andy said it best. “Being asked to accomplish seemingly impossible goals on a regular basis is just what we do, but these days it feels more like t...</p></div>
</div></a>
</div>
<div class="card"> <a href="/posts/son-of-a-batch-autocad-core-console-through-lisp/"><div class="card-body"> <span class="timeago small"> Oct 5, 2016 <i class="unloaded">2016-10-05T12:39:00-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Son of a Batch! AutoCAD Core Console Through Lisp</h3>
<div class="text-muted small"><p> AutoLisp is a very convenient tool for making custom commands and automating tasks, but there are some trade-offs that are made when working with the convenience of the built in Visual Lisp IDE. On...</p></div>
</div></a>
</div>
</div>
</div>
<div class="post-navigation d-flex justify-content-between"> <a href="/posts/revit-shortcuts-for-autocad-users/" class="btn btn-outline-primary" prompt="Older"><p>Revit Shortcuts for AutoCAD Users</p></a> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span>
</div>
</div></div></div>
<footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center">
<div class="footer-left"><p class="mb-0"> © 2022 <a href="https://www.linkedin.com/in/andrew-hepker-738b0b80/" target="_blank" rel="noopener noreferrer">House of BIM</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div>
<div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener noreferrer">Chirpy</a> theme.</p></div>
</div></footer>
</div>
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content">
<div id="search-hints">
<h4 class="text-muted mb-4">Trending Tags</h4>
<a class="post-tag" href="/tags/autocad/">AutoCAD</a> <a class="post-tag" href="/tags/fabrication/">Fabrication</a> <a class="post-tag" href="/tags/vla/">VLA</a> <a class="post-tag" href="/tags/lisp/">Lisp</a> <a class="post-tag" href="/tags/visual-lisp/">Visual Lisp</a> <a class="post-tag" href="/tags/activex/">ActiveX</a> <a class="post-tag" href="/tags/automation/">Automation</a> <a class="post-tag" href="/tags/cadmep/">cadMEP</a> <a class="post-tag" href="/tags/command/">command</a> <a class="post-tag" href="/tags/fabrication-api/">Fabrication API</a>
</div>
<div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
</div></div>
</div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
