<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Accessing Fabricaton Items Through .NET" /><meta name="author" content="Skylar Daniels" /><meta property="og:locale" content="en_US" /><meta name="description" content="Like AutoCAD, Fabrication MEP has its own API that can be used to read/write properties, and access different Fabrication objects.  If you have used .NET to create commands for AutoCAD in the past but had difficulty setting up a project to access Fabrication Items, this post may help. If you are new to setting up an AutoCAD project in .NET (the example below is in C#) the link Here will show you how to set up a new AutoCAD project in visual studio using VB.NET, but the setup for C# is the same.  If you are new to .NET and or programming, I recommend checking out Josh’s post: “Update my C# Roadmap”, particularly Bob Tabors class on Microsoft Virtual Academy: “C# Fundamentals for Absolute Beginners”.  After going through the videos and reading some examples in the help files and online, you should be ready to start poking around with customizing AutoCAD." /><meta property="og:description" content="Like AutoCAD, Fabrication MEP has its own API that can be used to read/write properties, and access different Fabrication objects.  If you have used .NET to create commands for AutoCAD in the past but had difficulty setting up a project to access Fabrication Items, this post may help. If you are new to setting up an AutoCAD project in .NET (the example below is in C#) the link Here will show you how to set up a new AutoCAD project in visual studio using VB.NET, but the setup for C# is the same.  If you are new to .NET and or programming, I recommend checking out Josh’s post: “Update my C# Roadmap”, particularly Bob Tabors class on Microsoft Virtual Academy: “C# Fundamentals for Absolute Beginners”.  After going through the videos and reading some examples in the help files and online, you should be ready to start poking around with customizing AutoCAD." /><link rel="canonical" href="/posts/accessing-fabricaton-items-through-net/" /><meta property="og:url" content="/posts/accessing-fabricaton-items-through-net/" /><meta property="og:site_name" content="House of BIM" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2017-01-14T13:28:00-07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Accessing Fabricaton Items Through .NET" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"headline":"Accessing Fabricaton Items Through .NET","dateModified":"2022-01-07T14:22:07-07:00","datePublished":"2017-01-14T13:28:00-07:00","description":"Like AutoCAD, Fabrication MEP has its own API that can be used to read/write properties, and access different Fabrication objects.  If you have used .NET to create commands for AutoCAD in the past but had difficulty setting up a project to access Fabrication Items, this post may help. If you are new to setting up an AutoCAD project in .NET (the example below is in C#) the link Here will show you how to set up a new AutoCAD project in visual studio using VB.NET, but the setup for C# is the same.  If you are new to .NET and or programming, I recommend checking out Josh’s post: “Update my C# Roadmap”, particularly Bob Tabors class on Microsoft Virtual Academy: “C# Fundamentals for Absolute Beginners”.  After going through the videos and reading some examples in the help files and online, you should be ready to start poking around with customizing AutoCAD.","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/accessing-fabricaton-items-through-net/"},"url":"/posts/accessing-fabricaton-items-through-net/","@type":"BlogPosting","author":{"@type":"Person","name":"Skylar Daniels"},"@context":"https://schema.org"}</script><title>Accessing Fabricaton Items Through .NET | House of BIM</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end">
<div class="profile-wrapper text-center">
<div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/favicons/favicon-96x96.png" alt="avatar" onerror="this.style.display='none'"> </a>
</div>
<div class="site-title mt-3"> <a href="/">House of BIM</a>
</div>
<div class="site-subtitle font-italic">Stuff and Things...it's what we do</div>
</div>
<ul class="w-100">
<li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a>
</li>
<li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a>
</li>
<li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a>
</li>
<li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-database ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a>
</li>
<li class="nav-item"> <a href="/links/" class="nav-link"> <i class="fa-fw fa fa-link ml-xl-3 mr-xl-3 unloaded"></i> <span>LINKS</span> </a>
</li>
<li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fa fa-question ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a>
</li>
</ul>
<div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/AHepker-HOB" aria-label="github" class="order-3" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/andrew-hepker-738b0b80/" aria-label="linkedin" class="order-4" target="_blank" rel="noopener noreferrer"> <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href=%5B'mailto:',%20'andrew',%20'.',%20'hepker',%20'@house',%20'ofbim.com'%5D.join('')" aria-label="email" class="order-5"> <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6"> <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span>
</div>
</div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Accessing Fabricaton Items Through .NET</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div>
<i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel">Cancel</span>
</div></div><div id="main-wrapper">
<div id="main">
<div class="row">
<div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
<h1 data-toc-skip>Accessing Fabricaton Items Through .NET</h1>
<div class="post-meta text-muted d-flex flex-column">
<div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Jan 14, 2017, 1:28 PM -0700"> Jan 14, 2017 <i class="unloaded">2017-01-14T13:28:00-07:00</i> </span> by <span class="author"> Skylar Daniels </span>
</div>
<div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Fri, Jan 7, 2022, 2:22 PM -0700"> Jan 7 <i class="unloaded">2022-01-07T14:22:07-07:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1182 words">6 min</span>
</div>
</div>
<div class="post-content">
<p>Like AutoCAD, Fabrication MEP has its own API that can be used to read/write properties, and access different Fabrication objects.  If you have used .NET to create commands for AutoCAD in the past but had difficulty setting up a project to access Fabrication Items, this post may help. If you are new to setting up an AutoCAD project in .NET (the example below is in C#) the <a href="https://knowledge.autodesk.com/support/autocad/learn-explore/caas/simplecontent/content/my-first-autocad-plug-overview.html" target="_blank" rel="noopener noreferrer">link Here</a> will show you how to set up a new AutoCAD project in visual studio using VB.NET, but the setup for C# is the same.  If you are new to .NET and or programming, I recommend checking out Josh’s post: “Update my C# Roadmap”, particularly Bob Tabors class on Microsoft Virtual Academy: <a href="https://mva.microsoft.com/en-us/training-courses/c-fundamentals-for-absolute-beginners-16169?l=Lvld4EQIC_2706218949" target="_blank" rel="noopener noreferrer">“C# Fundamentals for Absolute Beginners”</a>.  After going through the videos and reading some examples in the help files and online, you should be ready to start poking around with customizing AutoCAD.</p>
<p>A common object that users interact with in a Fabrication drawing is an “Item” which, depending on the version of Fabrication, has properties that are read/write, and properties that are read only.  A “Job Item” is an instance of the parent Fabrication ITM.  Because it is an Instance of an ITM, some properties that we can write to will persist, and some will go back to that of the Parent ITM.  In order to make changes to the parent ITM we need to change the “Disk Item”, which will be in a future post.  It is important to note that if we change the parent ITM, <strong><em>ALL</em></strong> instances in all drawings will be effected by any changes that we make. There is a help file called “FabricationAPI.chm” located at “C:\Program Files\Autodesk\Fabrication 2017\SDK” that outlines the API and has examples to help you get started.</p>
<p>Before we access the Fabrication Items we need to set up a project correctly.  After the AutoCAD project set up in Visual Studio, the next step is to reference the FabricationAPI.dll located at “C:\Program Files\Autodesk\Fabrication 2017\CADmep”.  There is another critical step in order to get your Plugin to work.  This step is mentioned in the FabricationAPI.chm help file under Contents\Getting Started\Addin Integration\Addin Integration-CADmep. It states:</p>
<blockquote><p>“As of the 2016 release of the Autodesk Fabrication API, it is required that the FabricationAPI.dll is loaded when Initializing the AutoCAD addin.  This can be done using the following method: System.Reflection.Assembly.LoadFrom(path to FabricationAPI.dll in CADmep);”</p></blockquote>
<p>It is important to add the above Method where the Plugin is initialized.  If you use the wizard to set your project up, there is a file in your project called “MyPlugin.cs” which has the initialization interface code block already populated.  In the example provided, I just added the MyPlugin class at the beginning of the “FabCommand” class.</p>
<p>In the code below, the user selects some Fabrication objects, the command then iterates through the selection and get a list of the unique spool names and prints them to the command line.  We can access the Items by simply supplying the entity handle string to the Job.GetFabricationItemFromACADHandle() method.</p>
<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
</pre></td>
<td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Autodesk.AutoCAD.Runtime</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Autodesk.AutoCAD.ApplicationServices</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Autodesk.AutoCAD.DatabaseServices</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Autodesk.AutoCAD.EditorInput</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Autodesk.Fabrication</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">FabricationExample</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">FabCommand</span>
    <span class="p">{</span>
        <span class="c1">//Important!!!!</span>
        <span class="c1">//This is needed for using Reflection of the FabricaitonAPI.dll</span>
        <span class="c1">//Without this class, the plugin will not work.  See C:\Program Files\Autodesk\Fabrication 2017\SDK\FabricationAPI.chm for more details</span>
        <span class="k">public</span> <span class="k">class</span> <span class="nc">MyPlugin</span> <span class="p">:</span> <span class="n">IExtensionApplication</span>
        <span class="p">{</span>
            <span class="k">void</span> <span class="n">IExtensionApplication</span><span class="p">.</span><span class="nf">Initialize</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="n">System</span><span class="p">.</span><span class="n">Reflection</span><span class="p">.</span><span class="n">Assembly</span><span class="p">.</span><span class="nf">LoadFrom</span><span class="p">(</span><span class="s">"C:\\Program Files\\Autodesk\\Fabrication 2017\\CADmep\\FabricationAPI.dll"</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">void</span> <span class="n">IExtensionApplication</span><span class="p">.</span><span class="nf">Terminate</span><span class="p">()</span>
            <span class="p">{</span>
                <span class="c1">// Do plug-in application clean up here</span>
            <span class="p">}</span>
    
        <span class="p">}</span>
    
        <span class="c1">//Start of the command "UniqueSpools"</span>
        <span class="p">[</span><span class="nf">CommandMethod</span><span class="p">(</span><span class="s">"UniqueSpools"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">UniqueSpools</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">//Initialize list of spools</span>
            <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">usedSpools</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;();</span>
    
            <span class="c1">//Get the current document, database, and editor object</span>
            <span class="n">Document</span> <span class="n">doc</span> <span class="p">=</span> <span class="n">Application</span><span class="p">.</span><span class="n">DocumentManager</span><span class="p">.</span><span class="n">MdiActiveDocument</span><span class="p">;</span>
            <span class="n">Database</span> <span class="n">db</span> <span class="p">=</span> <span class="n">doc</span><span class="p">.</span><span class="n">Database</span><span class="p">;</span>
            <span class="n">Editor</span> <span class="n">ed</span> <span class="p">=</span> <span class="n">doc</span><span class="p">.</span><span class="n">Editor</span><span class="p">;</span>
    
            <span class="c1">//Set up a typed value array for selection filter</span>
            <span class="n">TypedValue</span><span class="p">[]</span> <span class="n">typeArray</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TypedValue</span><span class="p">[</span><span class="m">1</span><span class="p">];</span>

            <span class="c1">//For Lispers; Works like using DXF group codes, same as (0 . "MAPS_SOLID")</span>
            <span class="n">typeArray</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TypedValue</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">DxfCode</span><span class="p">.</span><span class="n">Start</span><span class="p">,</span> <span class="s">"MAPS_SOLID"</span><span class="p">);</span> 
    
            <span class="c1">//Set selection filter from our typed array and prompt user selection</span>
            <span class="n">SelectionFilter</span> <span class="n">selFilter</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SelectionFilter</span><span class="p">(</span><span class="n">typeArray</span><span class="p">);</span>
            <span class="n">PromptSelectionResult</span> <span class="n">selResult</span> <span class="p">=</span> <span class="n">ed</span><span class="p">.</span><span class="nf">GetSelection</span><span class="p">(</span><span class="n">selFilter</span><span class="p">);</span>
    
            <span class="c1">//If user presses enter, iterate through selection</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">selResult</span><span class="p">.</span><span class="n">Status</span> <span class="p">==</span> <span class="n">PromptStatus</span><span class="p">.</span><span class="n">OK</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">//get transaction object</span>
                <span class="k">using</span> <span class="p">(</span><span class="n">Transaction</span> <span class="n">tr</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">TransactionManager</span><span class="p">.</span><span class="nf">StartTransaction</span><span class="p">())</span>
                <span class="p">{</span>
                    <span class="n">SelectionSet</span> <span class="n">ss</span> <span class="p">=</span> <span class="n">selResult</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
    
                    <span class="c1">//Iterate through the selection set</span>
                    <span class="k">foreach</span> <span class="p">(</span><span class="n">SelectedObject</span> <span class="n">selObject</span> <span class="k">in</span> <span class="n">ss</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">selObject</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="c1">//Get the entity</span>
                            <span class="n">Entity</span> <span class="n">ent</span> <span class="p">=</span> <span class="n">tr</span><span class="p">.</span><span class="nf">GetObject</span><span class="p">(</span><span class="n">selObject</span><span class="p">.</span><span class="n">ObjectId</span><span class="p">,</span> <span class="n">OpenMode</span><span class="p">.</span><span class="n">ForRead</span><span class="p">)</span> <span class="k">as</span> <span class="n">Entity</span><span class="p">;</span>
    
                            <span class="k">if</span> <span class="p">(</span><span class="n">ent</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
                            <span class="p">{</span>
                                <span class="c1">//Get the Fabrication Item from the entity handle</span>
                                <span class="n">Item</span> <span class="n">item</span> <span class="p">=</span> <span class="n">Job</span><span class="p">.</span><span class="nf">GetFabricationItemFromACADHandle</span><span class="p">(</span><span class="n">ent</span><span class="p">.</span><span class="n">Handle</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
    
                                <span class="c1">//If object is a Fabrication item, check to see if the spool name is in our list.</span>
                                <span class="c1">//Add to list if it does not exist.</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">item</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
                                <span class="p">{</span>
                                    <span class="k">if</span> <span class="p">(!</span><span class="n">usedSpools</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">SpoolName</span><span class="p">))</span>
                                        <span class="n">usedSpools</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">SpoolName</span><span class="p">);</span>
                                <span class="p">}</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
    
                <span class="c1">//Print a list of all unique spool names to the command line</span>
                <span class="n">ed</span><span class="p">.</span><span class="nf">WriteMessage</span><span class="p">(</span><span class="s">"List of unique Spools:"</span><span class="p">);</span>
                <span class="k">foreach</span> <span class="p">(</span><span class="kt">string</span> <span class="n">spool</span> <span class="k">in</span> <span class="n">usedSpools</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">ed</span><span class="p">.</span><span class="nf">WriteMessage</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"\n{0}"</span><span class="p">,</span> <span class="n">spool</span><span class="p">));</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div></div>
<p>Below is an example of a creating a Lisp Function that can be used to find the Connector Vector of an Item. The function takes two arguments, the entity handle (string), and the Connector index (short), and returns a point (list of doubles) from the Connector origin. Connector Vector is an example of a property that can only be accessed through the Fabrication .NET API. This vector can be used to calculate the true midpoint of fabrication Items.</p>
<div class="language-c# highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr>
<td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre></td>
<td class="rouge-code"><pre><span class="k">using</span> <span class="nn">Autodesk.AutoCAD.Runtime</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Autodesk.AutoCAD.DatabaseServices</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Autodesk.Fabrication</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Autodesk.Fabrication.Geometry</span><span class="p">;</span>

<span class="p">[</span><span class="n">assembly</span><span class="p">:</span> <span class="nf">CommandClass</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">ConnVector</span><span class="p">.</span><span class="n">MyCommands</span><span class="p">))]</span>

<span class="k">namespace</span> <span class="nn">ConnVector</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">MyPlugin</span> <span class="p">:</span> <span class="n">IExtensionApplication</span>
    <span class="p">{</span>
        <span class="k">void</span> <span class="n">IExtensionApplication</span><span class="p">.</span><span class="nf">Initialize</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="n">Reflection</span><span class="p">.</span><span class="n">Assembly</span><span class="p">.</span><span class="nf">LoadFrom</span><span class="p">(</span><span class="s">"C:\\Program Files\\Autodesk\\Fabrication 2017\\CADmep\\FabricationAPI.dll"</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">void</span> <span class="n">IExtensionApplication</span><span class="p">.</span><span class="nf">Terminate</span><span class="p">()</span>
        <span class="p">{</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">public</span> <span class="k">class</span> <span class="nc">MyCommands</span>
    <span class="p">{</span>
        <span class="p">[</span><span class="nf">LispFunction</span><span class="p">(</span><span class="s">"ConnVector"</span><span class="p">)]</span>
        <span class="k">public</span> <span class="n">ResultBuffer</span> <span class="nf">ConnVectorLispFunction</span><span class="p">(</span><span class="n">ResultBuffer</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">string</span> <span class="n">eHandle</span><span class="p">;</span>
            <span class="kt">short</span> <span class="n">connectorIndex</span><span class="p">;</span>
            <span class="n">Point3D</span> <span class="n">p3</span><span class="p">;</span>
            <span class="n">TypedValue</span><span class="p">[]</span> <span class="n">input</span> <span class="p">=</span> <span class="n">args</span><span class="p">.</span><span class="nf">AsArray</span><span class="p">();</span>
    
            <span class="c1">//Set the first argument to the entity handle</span>
            <span class="n">eHandle</span> <span class="p">=</span> <span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="n">input</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Value</span><span class="p">;</span>
    
            <span class="c1">//Set the second argument to the connector index</span>
            <span class="n">connectorIndex</span> <span class="p">=</span> <span class="p">(</span><span class="kt">short</span><span class="p">)</span><span class="n">input</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">Value</span><span class="p">;</span>
    
            <span class="c1">//Get fabrication item from the entity handle</span>
            <span class="n">Item</span> <span class="n">item</span> <span class="p">=</span> <span class="n">Job</span><span class="p">.</span><span class="nf">GetFabricationItemFromACADHandle</span><span class="p">(</span><span class="n">eHandle</span><span class="p">);</span>
    
            <span class="c1">//get the connector vector of the specified index</span>
            <span class="n">p3</span> <span class="p">=</span> <span class="n">item</span><span class="p">.</span><span class="nf">GetConnectorDirectionVector</span><span class="p">(</span><span class="n">connectorIndex</span><span class="p">);</span>
    
            <span class="c1">//Prepare and return the Result buffer as a point (list of reals)</span>
            <span class="n">ResultBuffer</span> <span class="n">resBuff</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ResultBuffer</span><span class="p">();</span>
            <span class="n">resBuff</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">TypedValue</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LispDataType</span><span class="p">.</span><span class="n">ListBegin</span><span class="p">));</span>
            <span class="n">resBuff</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">TypedValue</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LispDataType</span><span class="p">.</span><span class="n">Double</span><span class="p">,</span> <span class="n">p3</span><span class="p">.</span><span class="n">X</span><span class="p">));</span>
            <span class="n">resBuff</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">TypedValue</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LispDataType</span><span class="p">.</span><span class="n">Double</span><span class="p">,</span> <span class="n">p3</span><span class="p">.</span><span class="n">Y</span><span class="p">));</span>
            <span class="n">resBuff</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">TypedValue</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LispDataType</span><span class="p">.</span><span class="n">Double</span><span class="p">,</span> <span class="n">p3</span><span class="p">.</span><span class="n">Z</span><span class="p">));</span>
            <span class="n">resBuff</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">TypedValue</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">LispDataType</span><span class="p">.</span><span class="n">ListEnd</span><span class="p">));</span>
            <span class="k">return</span> <span class="n">resBuff</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td>
</tr></tbody></table></code></div></div>
<p>Here is a <a href="/assets/dotnet/ConnVector.dll">link to the dll</a></p>
<p>Thank you for taking the time to read this post and please leave a comment or email me at Skylar.Daniels@houseofbim.com with any questions or suggestions.</p>
</div>
<div class="post-tail-wrapper text-muted">
<div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href="/categories/net/">.NET</a>, <a href="/categories/fabrication-cadmep/">Fabrication CADmep</a>
</div>
<div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/autodesk/" class="post-tag no-text-decoration">Autodesk</a> <a href="/tags/automation/" class="post-tag no-text-decoration">Automation</a> <a href="/tags/command/" class="post-tag no-text-decoration">command</a> <a href="/tags/fabrication/" class="post-tag no-text-decoration">Fabrication</a> <a href="/tags/fabrication-api/" class="post-tag no-text-decoration">Fabrication API</a>
</div>
<div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
<div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener noreferrer">CC BY 4.0</a> by the author.</div>
<div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span>
</div>
</div>
</div>
</div></div>
<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access">
<div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/accessing-fabricaton-items-through-net/">Accessing Fabricaton Items Through .NET</a></li></ul>
</div>
<div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/autocad/">AutoCAD</a> <a class="post-tag" href="/tags/fabrication/">Fabrication</a> <a class="post-tag" href="/tags/vla/">VLA</a> <a class="post-tag" href="/tags/lisp/">Lisp</a> <a class="post-tag" href="/tags/visual-lisp/">Visual Lisp</a> <a class="post-tag" href="/tags/activex/">ActiveX</a> <a class="post-tag" href="/tags/automation/">Automation</a> <a class="post-tag" href="/tags/cadmep/">cadMEP</a> <a class="post-tag" href="/tags/command/">command</a> <a class="post-tag" href="/tags/fabrication-api/">Fabrication API</a>
</div>
</div>
</div></div>
</div>
<div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
<div id="related-posts" class="mt-5 mb-2 mb-sm-4">
<h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3>
<div class="card-deck mb-4">
<div class="card"> <a href="/posts/design-line-automation-segment-auditing/"><div class="card-body"> <span class="timeago small"> Sep 25, 2016 <i class="unloaded">2016-09-25T16:19:00-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Design Line Automation Segment Auditing</h3>
<div class="text-muted small"><p> If you have ever been given a Revit model and tried to get a leg up on your job using ProcessRun, then you have known true frustration. It isn’t perfect, but it is a truly epic tool that can direct...</p></div>
</div></a>
</div>
<div class="card"> <a href="/posts/sl1-in-viewports-for-autodesk-fabrication/"><div class="card-body"> <span class="timeago small"> Oct 2, 2016 <i class="unloaded">2016-10-02T18:04:00-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>SL1 in Viewports for Autodesk Fabrication</h3>
<div class="text-muted small"><p> A while back I was reading the Autodesk Fabrication Idea Station and I saw a request that caught my eye. I think the reason why it stood out was because it was so obvious. I actually immediately we...</p></div>
</div></a>
</div>
<div class="card"> <a href="/posts/creating-spool-search-sets/"><div class="card-body"> <span class="timeago small"> Oct 31, 2016 <i class="unloaded">2016-10-31T11:48:00-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Creating Navis Spool Search Sets</h3>
<div class="text-muted small"><p> Many of the posts so far have been about AutoCAD customization and Autolisp tips, so I thought I would write a post about a workflow that you may be able to incorporate into your BIM process (this ...</p></div>
</div></a>
</div>
</div>
</div>
<div class="post-navigation d-flex justify-content-between"> <a href="/posts/sonofabatch-plugin-a-multi-batch-utility/" class="btn btn-outline-primary" prompt="Older"><p>SonOfABatch Plugin: A Multi-Batch Utility</p></a> <a href="/posts/fabrication-scripting-vla-notes-property/" class="btn btn-outline-primary" prompt="Newer"><p>Fabrication Scripting &amp; VLA Notes Property</p></a>
</div>
</div></div></div>
<footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center">
<div class="footer-left"><p class="mb-0"> © 2022 <a href="https://www.linkedin.com/in/andrew-hepker-738b0b80/" target="_blank" rel="noopener noreferrer">House of BIM</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div>
<div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener noreferrer">Chirpy</a> theme.</p></div>
</div></footer>
</div>
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content">
<div id="search-hints">
<h4 class="text-muted mb-4">Trending Tags</h4>
<a class="post-tag" href="/tags/autocad/">AutoCAD</a> <a class="post-tag" href="/tags/fabrication/">Fabrication</a> <a class="post-tag" href="/tags/vla/">VLA</a> <a class="post-tag" href="/tags/lisp/">Lisp</a> <a class="post-tag" href="/tags/visual-lisp/">Visual Lisp</a> <a class="post-tag" href="/tags/activex/">ActiveX</a> <a class="post-tag" href="/tags/automation/">Automation</a> <a class="post-tag" href="/tags/cadmep/">cadMEP</a> <a class="post-tag" href="/tags/command/">command</a> <a class="post-tag" href="/tags/fabrication-api/">Fabrication API</a>
</div>
<div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
</div></div>
</div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
